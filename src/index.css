@layer reset, tokens, general, specific, states, theme.light, theme.dark, overrides;

@import url("./styles/reset.css") layer(reset);
@import url("./styles/tokens.css") layer(tokens);
@import url("./styles/defaults.css") layer(general);


@layer overrides {
  /* Visually hidden elements are visible to screen readers */
  .visually-hidden {
    clip-path: inset(100%);
    clip: rect(1px, 1px, 1px, 1px);
    height: 1px;
    overflow: hidden;
    position: absolute;
    white-space: nowrap;
    width: 1px;
  }
}

@media (prefers-color-scheme: light) {
  @layer theme.light {
    :root {
      --text-color: var(--colorPrimary);
      --background-color: var(--colorPrimaryInverted);
      --disabled-background-color: var(--colorDisabledLight);
      --disabled-text-color: var(--colorDisabledMedium);

      --correct-text-color: var(--colorSuccessLightTheme);
      --correct-background-color: var(--background-color);
      --wrong-text-color: var(--colorErrorLightTheme);
      --wrong-background-color: var(--background-color);
    }
  }
}

@media (prefers-color-scheme: dark) {
  @layer theme.dark {
    :root {
      --text-color: var(--colorPrimaryInverted);
      --background-color: var(--colorPrimary);
      --disabled-background-color: var(--colorDisabledDark);
      --disabled-text-color: var(--colorDisabledMedium);

      --correct-text-color: var(--colorSuccessDarkTheme);
      --correct-background-color: var(--background-color);
      --wrong-text-color: var(--colorErrorDarkTheme);
      --wrong-background-color: var(--background-color);
    }
  }
}

@layer general {

    .root {
      position: relative;
    }
  
    body {
      background-color: var(--background-color);
      color: var(--text-color);
    
      font-family: var(--text-font-family);
      font-size: var(--text-font-size);
      font-weight: var(--body-font-weight);
    }

    header, main, footer {
      width: var(--content-width);
      margin-inline: var(--content-margins);
      padding-inline: var(--landmark-padding-inline);
    }

    main {
      display: var(--main-display);
      flex-direction: var(--main-direction);

      margin-block-end: var(--main-margin-bottom);
    }

    ol {
      padding-left: var(--ordered-list-left-gap);
    }

    header {
      margin-block: var(--header-margin-block);
    }
    
    h1, h2, h3 {
      font-family: var(--heading-font-family);
    }

    h1 {
      margin-block-end: var(--title-margin-bottom);

      font-size: var(--title-font-size);
      text-align: var(--title-text-alignment);
      line-height: var(--title-line-height);
      text-transform: var(--heading-text-transform);
      letter-spacing: var(--heading-letter-spacing);
    }

    p:is(.card p) {
      font-size: var(--card-text-font-size);
    }

    p:where(:not(.card p)) {
      line-height: var(--text-line-height);
      font-weight: var(--text-font-weight);
    }

    h1 + p {
      width: var(--title-subheading-width);
      margin-inline: var(--title-subheading-margin);
    
      text-align: var(--subheading-text-alignment);
      line-height: var(--subheading-line-height);
      font-size: var(--title-subheading-text-size);
      
      text-wrap: var(--title-subheading-text-wrap);  
    }

    button.withIcon:is(.disclosure button.withIcon) {
      margin-block-end: var(--disclosure-button-margin-bottom);
    }

    h2:is(footer h2) {
      margin-block: var(--footer-subheading-margin);

      font-size: var(--subheading-font-size);
      text-transform: var(--heading-text-transform);
      letter-spacing: var(--heading-letter-spacing);
    }

    button {
      min-width: var(--button-min-width);
      padding-inline: var(--button-padding-inline);
      padding-block: var(--button-padding-block);

      font-size: var(--control-font-size);

      /* COLORS */
      background-color: var(--background-color);
      border: var(--borderWidthPrimary) solid var(--text-color);
      color: var(--text-color);

      /* Animations */
      transition: var(--button-transition);
    }

    button.withIcon {
      padding-inline: var(--button-with-icon-inline-padding);
      border: var(--button-withIcon-border);

      font-family: var(--button-withIcon-font-family);
      font-size: var(--button-withIcon-font-size);
      text-decoration: var(--button-withIcon-text-decoration);
    }

    button.withIcon span {
      vertical-align: var(--button-with-icon-vertical-align);
    }

    button.withIcon[aria-expanded]:is(.disclosure button) span::after {
      content: '';
      width: var(--disclosure-control-icon-width);
      height: var(--disclosure-control-icon-height);
      margin-left: var(--disclosure-control-icon-gap);

      clip-path: var(--disclosure-control-icon-shape);
      transform: rotate(var(--disclosure-control-icon-flip));

      vertical-align: var(--button-with-icon-icon-vertical-align);

      /* COLOR */
      background-color: var(--text-color);

      /* Animations */
      transition: var(--disclosure-button-icon-transition);
    }

    button.withIcon[aria-expanded="true"]:is(.disclosure button) span::after {
      transform: var(--disclosure-button-icon-transform);
    }

    .instruction {
      margin-block: var(--instruction-margin-block);
    }

    .instruction li p:not(li:last-child p) {
      margin-block-end: var(--instruction-item-margin);
    }

    [role="tablist"] {
      container: tablist / inline-size;
    }

    button[role="tab"] {
      position: var(--tab-position);
      padding-block: var(--tab-padding);

      border-bottom: var(--tab-bottom-border);
    }

    button[role="tab"]:not(:first-child) {
      margin-inline-start: var(--tab-left-margin);
    }

    button[role="tab"]:not([aria-selected="true"]) {
      border-width: var(--tab-border);
    }

    button[role="tab"][aria-selected="true"] {
      z-index: var(--tab-current-z-index);

      padding-block-start: var(--tab-padding-current);

      border-width: var(--current-tab-border-width);
    }

    button[role="tab"][aria-selected="true"]::after {
      content: '';
      display: var(--tabpanel-concealer-display);

      position: var(--tab-concealer-position);
      left: var(--tab-concealer-left);
      bottom: var(--tab-concealer-bottom);
      z-index: var(--tab-concealer-z-index);

      width: var(--tab-concealer-width);
      height: var(--tab-concealer-height);
      
      background-color: var(--background-color);
    }

    button[role="tab"] > span {
      display: var(--tab-caption-layout);
      align-items: var(--tab-caption-centering);
      padding: var(--tab-caption-padding);

      /* Animations */
      transition: var(--tab-caption-transition);
    }

    button[role="tab"] > span > span:nth-child(1) {
      margin-right: var(--tab-icon-gap);
      font-size: var(--tab-icon-size);
      line-height: var(--tab-icon-line-height);
    }

    @container tablist (width < calc(430 / 16 * 1rem)) {
      button[role="tab"] > span > span:nth-child(1) {
        display: var(--hide-emoji);
      }
    }

    @container tablist (width < calc(330 / 16 * 1rem)) {
      button[role="tab"] > span {
        flex-direction: var(--tab-caption-direction-narrow-screen);
        
        flex-direction: column;
        align-items: flex-start;
      }
    }

    [role="tabpanel"] {
      flex: var(--tabpanel-flex);

      padding: var(--tabpanel-padding);

      border: var(--tabpanel-border) solid var(--text-color);
    }

    .cards-container {
      display: var(--card-container-layout);
      grid-template-columns: var(--cards-container-template);
      gap: var(--cards-container-gap);
      grid-auto-rows: var(--cards-container-auto-rows);
      align-items: var(--cards-container-align-items);
    }

    .cards-container > p {
      grid-column: var(--tabpanel-empty-grid-column);
    }

    .card  {
      container: card/inline-size;

      position: var(--card-position);

      display: var(--card-layout);
      gap: var(--card-gap);

      /* Make cards same height */
      height: var(--card-height);
      padding: var(--card-padding);

      flex-direction: var(--card-flex-direction);

      border: var(--borderWidthPrimary) solid var(--text-color);
    }

    .card > div:first-child {
      
      display: var(--card-phrase-layout);
      gap: var(--card-phrase-gap);

      /* Make cards same size */
      flex: var(--card-phrase-flex);
      flex-direction: var(--card-phrase-flex-direction);
      justify-content: var(--card-phrase-justify-content);
    }

    .card > div:last-child {
      display: var(--card-check-layout);
      gap: var(--card-check-gap);
    }

    .card.updated {
      border: var(--updated-card-border);
    }

    .card.updated div {
      opacity: var(--updated-card-content-opacity);
    }

    .card.updated::before, .card.updated::after {
      position: var(--updated-card-cover-position);

      pointer-events: var(--updated-card-cover-pointer-events);

      opacity: var(--updated-card-cover-opacity);

      /* Animations */
      animation-duration: var(--updated-card-cover-animation-duration);
      animation-name: updatedCard;
      animation-iteration-count: var(--updated-card-cover-animation-repeats);
    }

    .card.updated::before {
      content: 'Без ответа';

      top: var(--updated-card-cover-vertical-shift);
      top: 50%;
      top: var(--updated-card-cover-vertical-shift-correction);
      transform: translateY(-50%);
      z-index: var(--updated-card-cover-layer);
      z-index: 1;

      width: var(--updated-card-cover-width);
      width: calc(100% - min(5%, 22px));

      font-size: var(--updated-card-cover-font-size);
      font-size: var(--title-font-size);
      font-family: var(--updated-card-cover-font-family);
      font-family: var(--heading-font-family);
      text-align: var(--updated-card-cover-text-align); 
      text-align: center;   
    }

    .card.updated.correct::before {
      content: 'Знаю!';
      color: var(--correct-text-color);
    }

    .card.updated.wrong::before {
      content: 'Учу!';
      color: var(--wrong-text-color);
    }

    .card.updated::after {
      content: '';
      
      inset: 0;

      border: 6px solid var(--text-color); 
      background-color: var(--background-color);
    }

    .card.updated.correct::after {
      border-color: var(--correct-text-color);
    }

    .card.updated.wrong::after {
      border-color: var(--wrong-text-color);
    }
  
    @keyframes updatedCard {
      0% {
        opacity: 0;
      }  
  
      50% {
        opacity: 1;
      }
  
      100% {
        opacity: 0;
      }
    } 

    footer {
      margin-bottom: var(--footer-margin-bottom);

      border-top: var(--borderWidthPrimary) solid var(--text-color);
    }

    div[role="alert"]:is(:empty) {
      display: none;
    }

    div[role="alert"] {
      position: fixed;
      z-index: 1;
      bottom: 24px;
      left: 24px;

      max-width: 200px;
      padding: 16px;

      font-size: var(--control-font-size);
      line-height: var(--text-line-height);

      border: 1px solid var(--text-color);
      background-color: var(--background-color);

      opacity: 0;
      animation-duration: 2.5s;
      animation-name: alert;
      animation-iteration-count: 1;
    }

    div[role="alert"] p {
      font-weight: 600;
      text-wrap: pretty;
    }

    div[role="alert"].correct {
      color: var(--correct-text-color);
      border-color: var(--correct-text-color);
    }

    div[role="alert"].wrong {
      color: var(--wrong-text-color);
      border-color: var(--wrong-text-color);
    }

    @keyframes alert {
      0% {
        opacity: 0;
      } 

      5% {
        opacity: 1;
      } 

      95% {
        opacity: 1;
      }
  
      100% {
        opacity: 0;
      }
    }
}

@layer specific {
  /* New approach, experiment */
  button.correct {
    --accent-color: var(--correct-text-color);
  }

  button.wrong {
    --accent-color: var(--wrong-text-color);
  }

  button.correct:not(button[role="tab"]) {
    background-color: var(--correct-background-color);
    color: var(--correct-text-color);
    border-color: var(--correct-text-color);
  }

  button.correct[role="tab"][aria-selected="true"] {
    border-color: var(--correct-text-color);
  }

  .card.wrong:is(div) {
    border-color: var(--wrong-text-color);
  }

  button.wrong:not(button[role="tab"]) {
    background-color: var(--wrong-background-color);
    color: var(--wrong-text-color);
    border-color: var(--wrong-text-color);
  }

  button.wrong[role="tab"][aria-selected="true"] {
    border-color: var(--wrong-text-color);
  }

  button.updated {
    animation-duration: 1s;
    animation-name: updatedTab;
    animation-iteration-count: 1;
  }

  @keyframes updatedTab {
    0% {
      color: var(--text-color);
    }  

    50% {
      color: var(--disabled-background-color);
    }

    100% {
      color: var(--text-color);
    }
  } 

  #tabpanel-1 {
    border-color: var(--correct-text-color);
  }

  #tabpanel-2 {
    border-color: var(--wrong-text-color);
  }

  .card.correct:not(.card button) {
    border-color: var(--correct-text-color);
  }
}

@layer states {
  :focus-visible {
    outline: var(--outlineOnFocus) solid var(--background-color);
    box-shadow: 0 0 0 var(--shadowOnFocus) var(--text-color);
    
    /* Animations */
    transition: box-shadow 0.2s ease-out, outline 0.2s ease-out;
  }

  button:focus-visible:not(.withIcon):not([role="tab"]) {
   background-color: var(--text-color);
   color: var(--background-color);
  }

  button.correct:focus-visible:not([role="tab"]) {
    background-color: var(--correct-text-color);
    color: var(--correct-background-color);
    box-shadow: 0 0 0 var(--shadowOnFocus) var(--correct-text-color);
  }

  button.wrong:focus-visible:not([role="tab"]) {
    background-color: var(--wrong-text-color);
    color: var(--wrong-background-color);
    box-shadow: 0 0 0 var(--shadowOnFocus) var(--wrong-text-color);
  }

   button[role="tab"]:is(:focus, :focus-visible) {
    box-shadow: unset;
    outline: unset;
  }

  button[role="tab"].correct:focus {
    color: var(--correct-text-color);
  }

  button[role="tab"].wrong:focus {
    color: var(--wrong-text-color);
  }

  button[role="tab"]:focus > span {
    outline: calc(2 / 16 * 1rem) solid var(--background-color);
    box-shadow: 0 0 0 calc(4 / 16 * 1rem) var(--text-color);
  }

  button[role="tab"].correct:focus > span {
    box-shadow: 0 0 0 calc(4 / 16 * 1rem) var(--correct-text-color);
  }

  button[role="tab"].wrong:focus > span {
    box-shadow: 0 0 0 calc(4 / 16 * 1rem) var(--wrong-text-color);
  }

  [role="tabpanel"]:focus-visible {
    background-color: var(--background-color);
  }

  .card:not(.updated):focus-within {
    outline: var(--outlineOnFocus) solid var(--background-color);
    box-shadow: 0 0 0 var(--shadowOnFocus) var(--text-color);
  }

  .card.correct:not(.updated):focus-within {
    box-shadow: 0 0 0 var(--shadowOnFocus) var(--correct-text-color);
  }

  .card.wrong:not(.updated):focus-within {
    box-shadow: 0 0 0 var(--shadowOnFocus) var(--wrong-text-color);
  }

  a:hover, a:focus {
    outline: var(--outlineOnFocus) solid var(--background-color);
    box-shadow: 0 0 0 var(--shadowOnFocus) var(--text-color);
  }

  button:not(:disabled):hover {
    cursor: pointer;

    /* Animations */
    transition: background-color 0.1s ease-out;
  }

  button:hover:where(:not(.withIcon):not(:disabled)) {
    background-color: var(--text-color);
    color: var(--background-color);
  }

  button.withIcon:hover {
    outline: var(--outlineOnFocus) solid var(--background-color);
    box-shadow: 0 0 0 var(--shadowOnFocus) var(--text-color);
  }

  button.correct:not([role="tab"]):not(:disabled):hover {
    background-color: var(--correct-text-color);
  }

  button.wrong:not([role="tab"]):not(:disabled):hover {
    background-color: var(--wrong-text-color);
  }

  button[role="tab"]:hover {
    background-color: var(--background-color);
  }

  button[role="tab"]:hover > span {
    background-color: var(--text-color);
    color: var(--background-color);
    outline: calc(2 / 16 * 1rem) solid var(--background-color);
    box-shadow: 0 0 0 calc(4 / 16 * 1rem) var(--text-color);
  }

  button[role="tab"].correct:hover > span {
    background-color: var(--correct-text-color);
    color: var(--correct-background-color);
    box-shadow: 0 0 0 calc(4 / 16 * 1rem) var(--correct-text-color);
  }

  button[role="tab"].wrong:hover > span {
    background-color: var(--wrong-text-color);
    color: var(--wrong-background-color);
    box-shadow: 0 0 0 calc(4 / 16 * 1rem) var(--wrong-text-color);
  }
  
  :disabled {
    background-color: var(--disabled-background-color);

    color: var(--disabled-text-color);
    border-color: var(--disabled-text-color);
  }

  :disabled:hover {
    cursor: not-allowed;
  }
}